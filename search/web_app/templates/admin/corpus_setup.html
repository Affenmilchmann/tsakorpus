<!DOCTYPE html>
<html lang="en">
<head>
<title>Set up a corpus</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" type="text/css" href="static/bootstrap-5.0.0-beta1-dist/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="static/css/corpus_setup.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
<script src="static/jquery-3.5.1-dist/jquery-3.5.1.min.js"></script>
<script type='text/javascript' src='static/bootstrap-5.0.0-beta1-dist/js/bootstrap.bundle.min.js'></script>
<script type='text/javascript' src='static/js/corpus_setup.js'></script>
<body>

<form id="settings_form">
<div class="row">
<div class="col-md-2"></div>
<div class="col-md-8">
<div class="accordion" id="setings_accordion">
<div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
        Introduction
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#setings_accordion">
      <div class="accordion-body">
		<h3>Corpus setup</h3>
		<p class="lead">This is a corpus setup page. You can use it to create a <code>corpus.json</code> file that you will move to the <code>/conf</code> directory before indexing your corpus. You can also edit <code>corpus.json</code> manually. After you are finished, the settings will be saved in this file:</p>
		<p class="text-center bd-highlight fs-2"><code>{{ filename }}</code></p>
		<p>This page is only available in English and can only be accessed when you run <code>tsakorpus.wsgi</code> as a standalone application on port 7342. The default values will be based on the current contents of <code>/conf/corpus.json</code>. It is assumed that you already have JSON files ready for indexing in <code>/corpus/%CORPUS_NAME%</code>.</p>
		<p>As Tsakorpus is designed for a multitude of formats and usage scenarios, there are a lot of options. Please be patient!</p>
      </div>
    </div>
</div>
<div class="accordion-item">
    <h2 class="accordion-header" id="headingTwo">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
        Basic settings
      </button>
    </h2>
    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#setings_accordion">
		<div class="accordion-body">
			<div class="mb-3 option_group">
				<label for="corpus_name" class="form-label">Corpus name</label>
				<input type="text" class="form-control" id="corpus_name" value="{{ settings.corpus_name }}">
				<p class="explanation">Please choose a <strong>unique</strong> name, preferably long and clearly identifying your corpus. This value is used in two places. First, it is used when naming elasticsearch databases. As a consequence, if there is another corpus with the same name on your server, its data will be overwritten. Second, all corpus JSON files must be stored in <code>/corpus/%CORPUS_NAME%/</code> at indexation time. The users will not see this value.</p>
			</div>
			<div class="mb-3 option_group">
				<label for="input_format" class="form-label">Input format</label>
				<select class="form-select" id="input_format">
				  <option value="json" {% if settings.input_format == "json" %}selected{% endif %}>uncompressed JSON</option>
				  <option value="json-gzip" {% if settings.input_format == "json-gzip" %}selected{% endif %}>gzipped JSON</option>
				</select>
				<p class="explanation">Your annotated files must be either in plain JSON (with the extension <code>.json</code>), or in gzipped JSON (with the extension <code>.json.gz</code>). The indexator will only look at files with the corresponding extension.</p>
			</div>
			<div class="form-check option_group">
			  <input class="form-check-input" type="checkbox" value="debug" id="debug" {% if settings.debug %}checked{% endif %}>
			  <label class="form-check-label" for="debug">
				Are you going to launch the corpus in debug mode? (Probably not if you are not one of the platform developers.) Uncheck in production environment!
			  </label>
			</div>
		</div>
    </div>
</div>
<div class="accordion-item">
	<h2 class="accordion-header" id="headingThree">
		<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
		Media
		</button>
	</h2>
    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#setings_accordion">
		<div class="accordion-body">
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="images" id="images" {% if settings.images %}checked{% endif %}>
				<label class="form-check-label" for="images">
				Does the corpus have aligned images?
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="media" id="media" {% if settings.media %}checked{% endif %}>
				<label class="form-check-label" for="media">
				Does the corpus have aligned sound or video files?
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="media_youtube" id="media_youtube" {% if settings.media_youtube %}checked{% endif %}>
				<label class="form-check-label" for="media_youtube">
				If there are sound or video files, are they stored on Youtube rather than locally?
				</label>
			</div>
			<div class="mb-3 option_group">
				<label for="media_length" class="form-label">Media fragment length in seconds</label>
				<input type="number" class="form-control" id="media_length" value="{{ settings.media_length }}">
				<p class="explanation">If there are sound or video files in the corpus, they are cut into overlapping fragments during source files conversion. This is done so that when someone finds a sentence, they could listen to its immediate context without having to download the entire file. All such fragments, apart from the last ones, have the same length; the default is 60 seconds. Please enter the same value you used in <code>/src_convertors/corpus/conf_conversion</code>.</p>
			</div>
		</div>
    </div>
</div>
<div class="accordion-item">
	<h2 class="accordion-header" id="heading4">
		<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4" aria-expanded="false" aria-controls="collapse4">
		Metadata, statistics and subcorpus selection
		</button>
	</h2>
    <div id="collapse4" class="accordion-collapse collapse" aria-labelledby="heading4" data-bs-parent="#setings_accordion">
		<div class="accordion-body">
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="ambiguous_analyses" id="ambiguous_analyses" {% if settings.ambiguous_analyses %}checked{% endif %}>
				<label class="form-check-label" for="ambiguous_analyses">
				Words may have multiple analyses (e.g. ambiguous analyses for the whole word or different analyses for different parts of a host-clitic combination written as one token).
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="keep_lemma_order" id="keep_lemma_order" {% if settings.keep_lemma_order %}checked{% endif %}>
				<label class="form-check-label" for="keep_lemma_order">
				If there are amiguous analyses, keep their mutual order in each word. (Otherwise, lemmata may be sorted lexicographically.)
				</label>
			</div>
			<div class="mb-3 option_group">
				<label for="word_fields" class="form-label">Additional word-level fields</label>
				<p class="explanation">Names of additional word-level metadata fields (e.g. translations into a metalanguage) that should appear when the user clicks <i class="bi bi-box-arrow-down" title="more fields"></i>. Write one per line.</p>
				<textarea class="form-control" id="word_fields" wrap="hard">{{ settings.word_fields|join('\n') }}</textarea>
			</div>
			<div class="mb-3 option_group">
				<label for="viewable_meta" class="form-label">Document-level metadata fields</label>
				<p class="explanation">Names of document-level metadata fields (e.g. author or genre) that should be present in a popup when the user clicks on a text header. Write one per line.</p>
				<textarea class="form-control" id="viewable_meta" wrap="hard">{{ settings.viewable_meta|join('\n') }}</textarea>
			</div>
			<div class="mb-3 option_group">
				<label for="sentence_meta" class="form-label">Sentence-level metadata fields</label>
				<p class="explanation">Names of sentence-level metadata fields (e.g. speaker code) that should be searchable and visible in a popup when the user moves the pointer over a sentence. Write one per line.</p>
				<textarea class="form-control" id="sentence_meta" wrap="hard">{{ settings.sentence_meta|join('\n') }}</textarea>
			</div>
			<div class="mb-3 option_group">
				<label for="integer_meta_fields" class="form-label">Integer sentence-level metadata fields</label>
				<p class="explanation">Names of sentence-level fields that have to be interpreted as integers rather than strings. Instead of a single text box, they will be represented by two text boxes where the user can specify a range.</p>
				<textarea class="form-control" id="integer_meta_fields" wrap="hard">{{ settings.integer_meta_fields|join('\n') }}</textarea>
			</div>
			<div class="mb-3 option_group">
				<label for="line_plot_meta" class="form-label">Integer sentence-level metadata fields with line plots</label>
				<p class="explanation">Names of integer sentence-level fields that have to be represented by a line plot rather than a bar chart in the statistics.</p>
				<textarea class="form-control" id="line_plot_meta" wrap="hard">{{ settings.line_plot_meta|join('\n') }}</textarea>
			</div>
			<div class="mb-3 option_group">
				<label for="search_meta.stat_options" class="form-label">Document- and sentence-level metadata in statistics popup</label>
				<p class="explanation">Names of those metadata fields that the user should be able to select when they click <i class="bi bi-bar-chart-line-fill" title="Show statistics"></i>. Document-level fields will also appear in the Subcorpus statistics tab. Write one per line.</p>
				<textarea class="form-control" id="search_meta.stat_options" wrap="hard">{{ settings.search_meta.stat_options|join('\n') }}</textarea>
			</div>
			<div class="mb-3 option_group">
				<p class="form-label">Subcorpus selection table</p>
				<p class="explanation">These text boxes define which document-level metadata fields should be present in the subcorpus selection popup and in which order. Elements in this popup are grouped into columns. Each column can contain elements of the following types: Text, Number, Range, Option button, Separator and Header. The last two elements are only needed for structuring the content and are not used in query building. For other elements, the <em>Name</em> property should be equal to one of the document-level metadata fields you have in your corpus. <em>Text</em> means a text box will appear in the popup; <em>Number</em> stand for a text box that only accepts numbers; <em>Range</em> stands for two text boxes that accept two numbers defining a range of values for a single metadata field. If there is a concise list of possible values for a metadata field, you can list them as <em>Option buttons</em> after the relevant text box. When the user toggles such a button, its <em>Value</em> will be appended or removed from the text box using the OR operator (<em>|</em>). The <em>Value</em> field can contain either a single metadata value or a combination of values and Boolean functions (<em>|</em> for OR, <em>,</em> for AND, <em>~</em> for NOT, and parentheses). If you want something other than the actual value to appear on the button in the web interface (e.g. <em>non-fiction</em> instead of <em>~fiction</em>), fill in the <em>Text</em> field.</p>
				<div style="display: none" class="column_stub">
					{% include "admin/subcorpus_select_col.html" %}
				</div>
				{% for column in settings.search_meta.columns %}
				<div class="meta_column removable_column" data-ncol="{{ loop.index }}">
					<div style="display: none" class="row_stub">
						{% include "admin/subcorpus_select_row.html" %}
					</div>
					<h5>Column #{{ loop.index }}</h5>
					<div class="row">
						<div class="col-md-3">Element type</div>
						<div class="col-md-3">Metadata field name</div>
						<div class="col-md-3">Metadata value (for option buttons)</div>
						<div class="col-md-3">Text (for option buttons; optional)</div>
					</div>
					{% set col_loop = loop %}
					{% for item in column %}
					<div class="row removable_row" data-nrow="{{ loop.index }}">
						<div class="col-md-3">
						<select class="form-select" name="search_meta.columns_{{ col_loop.index }}_{{ loop.index }}_type">
							<option value="input_text" {% if item.type=='input_text' %}selected{% endif %}>Text</option>
							<option value="input_number" {% if item.type=='input_number' %}selected{% endif %}>Number</option>
							<option value="input_range" {% if item.type=='input_range' %}selected{% endif %}>Range</option>
							<option value="option" {% if item.type=='option' %}selected{% endif %}>Option button for a text box</option>
							<option value="separator" {% if item.type=='separator' %}selected{% endif %}>Separator</option>
							<option value="header" {% if item.type=='header' %}selected{% endif %}>Header</option>
						</select>
						</div>
						<div class="col-md-3"><input type="text" class="form-control" name="search_meta.columns_{{ col_loop.index }}_{{ loop.index }}_name" value="{{ item.name }}"></div>
						<div class="col-md-3"><input type="text" class="form-control" name="search_meta.columns_{{ col_loop.index }}_{{ loop.index }}_value" value="{{ item.value }}"></div>
						<div class="col-md-3"><input type="text" class="form-control" name="search_meta.columns_{{ col_loop.index }}_{{ loop.index }}_text" value="{{ item.text }}"></div>
					</div>
					{% endfor %}
					<div class="row button_row">
						<div class="col-md-9"></div>
						<div class="col-md-3">
							<button type="button" class="btn btn-danger btn-sm del_row">Remove row</button>
							<button type="button" class="btn btn-primary btn-sm add_row">Add row</button>
						</div>
					</div>
				</div>
				{% endfor %}
				<div class="row button_row">
					<div class="col-md-9"></div>
					<div class="col-md-3">
						<button type="button" class="btn btn-danger del_col">Remove column</button>
						<button type="button" class="btn btn-primary add_col">Add column</button>
					</div>
				</div>
			</div>
		</div>
    </div>
</div>
<div class="accordion-item">
	<h2 class="accordion-header" id="heading5">
		<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse5" aria-expanded="false" aria-controls="collapse5">
		Search options
		</button>
	</h2>
    <div id="collapse5" class="accordion-collapse collapse" aria-labelledby="heading5" data-bs-parent="#setings_accordion">
		<div class="accordion-body">
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="all_language_search_enabled" id="all_language_search_enabled" {% if settings.all_language_search_enabled %}checked{% endif %}>
				<label class="form-check-label" for="all_language_search_enabled">
				If there are multiple tiers/languages in the corpus, "search in all languages" option is available.
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="fulltext_search_enabled" id="fulltext_search_enabled" {% if settings.fulltext_search_enabled %}checked{% endif %}>
				<label class="form-check-label" for="fulltext_search_enabled">
				Full-text search (a single text box underneath word query boxes) is enabled.
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="negative_search_enabled" id="negative_search_enabled" {% if settings.negative_search_enabled %}checked{% endif %}>
				<label class="form-check-label" for="negative_search_enabled">
				Negative search ("find all sentences without this word") is enabled.
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="gloss_search_enabled" id="gloss_search_enabled" {% if settings.gloss_search_enabled %}checked{% endif %}>
				<label class="form-check-label" for="gloss_search_enabled">
				Gloss search is enabled.
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="year_sort_enabled" id="year_sort_enabled" {% if settings.year_sort_enabled %}checked{% endif %}>
				<label class="form-check-label" for="year_sort_enabled">
				"Sort by year (descending)" option is enabled.
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="fulltext_view_enabled" id="fulltext_view_enabled" {% if settings.fulltext_view_enabled %}checked{% endif %}>
				<label class="form-check-label" for="fulltext_view_enabled">
				Full-text view is enabled. Do not check this if your texts are not in public domain and you do not have permission to distribute them.
				</label>
			</div>
			<div class="mb-3 option_group">
				<label for="max_context_expand" class="form-label">Maximum number of times you can click on "expand context" button</label>
				<input type="number" class="form-control" id="max_context_expand" value="{{ settings.max_context_expand }}">
				<p class="explanation">If your texts are subject to copyright, you can limit the maximum size of the snippet the user can see. Put <em>-1</em> to allow unlimited expanding.</p>
			</div>
			<div class="mb-3 option_group">
				<label for="max_hits_retrieve" class="form-label">Maximum number of hits (sentences) the user can see</label>
				<input type="number" class="form-control" id="max_hits_retrieve" value="{{ settings.max_hits_retrieve }}">
				<p class="explanation">If a search returns more sentences, they will be reflected in the statistics, but the user will only be able to look at this number of sentences. This number is connected to the Elasticsearch limit on maximum number of hits returned (<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html"><code>index.max_result_window</code> parameter</a>), which is 10,000 as of Elasticsearch 7.10. If you choose to increase this value, you will have to configure Elasticsearch accordingly, otherwise it will have no effect. Doing so may lead to very high memory consumption if the user actually wants to see these examples, so don't do it. If you want to look past the example number 10,000, it almost certainly means that you should narrow down your query or change the sorting method. For example, you want to look at older texts by switching on "sort by year" and going to the last page instead of setting year limits in the subcorpus selection. I don't know of anyone who would like to actually sift through more than 10,000 examples looking at each of them.</p>
			</div>
			<div class="mb-3 option_group">
				<label for="max_words_in_sentence" class="form-label">Maximum number of words in sentence</label>
				<input type="number" class="form-control" id="max_words_in_sentence" value="{{ settings.max_words_in_sentence }}">
				<p class="explanation">Sentences can have any number of words, of course, but there is a problem with multi-word search. If you search for more than one word and set strict distances, tsakorpus builds a very large Elasticsearch query that says something like "if word 1 is A and word 2 is B, or word 2 is A and word 3 is B, etc.". In order to make such queries finite, tsakorpus has to know where to stop. If you set this value too high, this will slow down multi-word search. If you have sentences longer than this limit, the extra words will be available for single-word search and multi-word search without distances, but invisible for multi-word search with distances.</p>
			</div>
			<div class="mb-3 option_group">
				<label for="max_docs_retrieve" class="form-label">Maximum number of rows in "Select documents" tab of subcorpus selection window</label>
				<input type="number" class="form-control" id="max_docs_retrieve" value="{{ settings.max_docs_retrieve }}">
				<p class="explanation">If you have too many documents, then too large number of rows may hang the browser.</p>
			</div>
			<div class="mb-3 option_group">
				<label for="query_timeout" class="form-label">Search timeout in seconds</label>
				<input type="number" class="form-control" id="query_timeout" value="{{ settings.query_timeout }}">
				<p class="explanation">Queries whose execution time exceeds this limit will be terminated. This is a safeguard against unexpectedly heavy searches that can hang your server. The actual execution time may be somewhat longer than this limit because of implementation details, but not significantly so.</p>
			</div>
		</div>
    </div>
</div>
<div class="accordion-item">
	<h2 class="accordion-header" id="heading6">
		<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse6" aria-expanded="false" aria-controls="collapse6">
		Basic interface options
		</button>
	</h2>
    <div id="collapse6" class="accordion-collapse collapse" aria-labelledby="heading6" data-bs-parent="#setings_accordion">
		<div class="accordion-body">
			<div class="mb-3 option_group">
				<label for="interface_languages" class="form-label">Interface languages</label>
				<p class="explanation">Codes of the languages the interface has to be available in. For each language in the list, the following translation files have to exist: (1) pyBabel <code>.po</code> translation files in <code>/search/web_app/translations/%LANGUAGE_CODE%/LC_MESSAGES/</code>; (2) help popup template <code>/search/web_app/templates/modals/help_dialogue_%LANGUAGE_CODE%.html</code>; (3) greeting alert <code>/search/web_app/templates/index/greeting_%LANGUAGE_CODE%.html</code>.</p>
				<textarea class="form-control" id="interface_languages" wrap="hard">{{ settings.interface_languages|join('\n') }}</textarea>
			</div>
			<div class="mb-3 option_group">
				<label for="default_locale" class="form-label">Default interface language</label>
				<input type="text" class="form-control" id="default_locale" value="{{ settings.default_locale }}">
				<p class="explanation">The code of the language the interface opens in by default. This code should also be in the "Interface languages" list.</p>
			</div>
			<div class="mb-3 option_group">
				<label for="start_page_url" class="form-label">URL of the corpus start page</label>
				<input type="text" class="form-control" id="start_page_url" value="{{ settings.start_page_url }}">
				<p class="explanation">Corpus name in the right upper corner will link to this URL. Do not forget to include <code>http[s]://</code> in it.</p>
			</div>
			<div class="mb-3 option_group">
				<label for="citation" class="form-label">How to cite the corpus</label>
				<p class="explanation">Citation string for the corpus. May include HTML. Only one citation string is available at the moment; if you want to have it in multiple languages, just list all language versions here.</p>
				<textarea class="form-control" id="citation" wrap="hard">{{ settings.citation }}</textarea>
			</div>
		</div>
    </div>
</div>
<div class="accordion-item">
	<h2 class="accordion-header" id="heading7">
		<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse7" aria-expanded="false" aria-controls="collapse7">
		Advanced interface options
		</button>
	</h2>
    <div id="collapse7" class="accordion-collapse collapse" aria-labelledby="heading7" data-bs-parent="#setings_accordion">
		<div class="accordion-body">
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="generate_dictionary" id="generate_dictionary" {% if settings.generate_dictionary %}checked{% endif %}>
				<label class="form-check-label" for="generate_dictionary">
				Generate an HTML dictionary for each language.
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="display_freq_rank" id="display_freq_rank" {% if settings.display_freq_rank %}checked{% endif %}>
				<label class="form-check-label" for="display_freq_rank">
				Display frequency rank / quantile column in word/lemma search.
				</label>
			</div>
			<div class="form-check option_group">
				<input class="form-check-input" type="checkbox" value="word_search_display_gr" id="word_search_display_gr" {% if settings.word_search_display_gr %}checked{% endif %}>
				<label class="form-check-label" for="word_search_display_gr">
				Display grammar column in word/lemma search.
				</label>
			</div>
			<div class="mb-3 option_group">
				<label for="word_table_fields" class="form-label">Additional word/lemma search columns</label>
				<p class="explanation">Names of additional word-level metadata fields (e.g. translations into a metalanguage) whose values should appear in separate columns in word/lemma search results. Write one per line.</p>
				<textarea class="form-control" id="word_table_fields" wrap="hard">{{ settings.word_table_fields|join('\n') }}</textarea>
			</div>
			<div class="mb-3 option_group">
				<label for="fulltext_page_size" class="form-label">Page size in full-text view</label>
				<input type="number" class="form-control" id="fulltext_page_size" value="{{ settings.fulltext_page_size }}">
				<p class="explanation">If full-text view is allowed, the texts are split into pages. This number determines how many sentences one page contains. Too high values may result in user's browser becoming less responsive or freezing.</p>
			</div>
			<div class="mb-3 option_group">
				<label for="author_metafield" class="form-label">Author metadata field</label>
				<input type="text" class="form-control" id="author_metafield" value="{{ settings.author_metafield }}">
				<p class="explanation">When displaying search hits, all examples are headed by the values of "title", "author" and "year" metadata fields. If you want to have something other than "author" as the second most important field, type its name here.</p>
			</div>
			<div class="mb-3 option_group">
				<label for="multiple_choice_fields" class="form-label">Multiple-choice sentence-level metadata fields</label>
				<p class="explanation">Names of sentence-level fields that should have a tag selection table like the <em>Grammar</em> field. Write one per line.</p>
				<textarea class="form-control" id="multiple_choice_fields" wrap="hard">{{ settings.multiple_choice_fields|join('\n') }}</textarea>
			</div>
			<div class="mb-3 option_group">
				<p class="form-label">Multiple-choice fields</p>
				<p class="explanation">A tag selection table is always present in the <em>Grammar</em> field, but you can also add one to any metadata search field that appears in the word query box. This makes sense for fields that have a limited number of values.</p>
				{% set cur_field = "settings.multiple_choice_fields" %}
				<div style="display: none" class="metafield_stub">
					{% include "admin/tag_select_metafield.html" %}
				</div>
				{% for key in settings.multiple_choice_fields %}
				<div class="meta_column removable_metafield" data-nfield={{ loop.index }}>
					<label for="{{ cur_field }}_{{ loop.index }}_key" class="form-label">Name of the multiple choice metadata field</label>
					<input type="text" class="form-control" id="{{ cur_field }}_{{ loop.index }}_key" value="{{ key }}">
					<div style="display: none" class="column_stub">
						{% include "admin/tag_select_col.html" %}
					</div>
					{% set field_loop = loop %}
					{% for column in settings.multiple_choice_fields[k].columns %}
					<div class="meta_column removable_column" data-ncol="{{ loop.index }}">
						<div style="display: none" class="row_stub">
							{% include "admin/tag_select_row.html" %}
						</div>
						<h5>Column #{{ loop.index }}</h5>
						<div class="row">
							<div class="col-md-3">Element type</div>
							<div class="col-md-3">Metadata field name</div>
							<div class="col-md-3">Metadata value (for option buttons)</div>
							<div class="col-md-3">Text (for option buttons; optional)</div>
						</div>
						{% set col_loop = loop %}
						{% for item in column %}
						<div class="row removable_row" data-nrow="{{ loop.index }}">
							<div class="col-md-3">
							<select class="form-select" name="{{ cur_field }}_{{ field_loop.index }}.columns_{{ col_loop.index }}_{{ loop.index }}_type">
								<option value="input_text" {% if item.type=='input_text' %}selected{% endif %}>Text</option>
								<option value="separator" {% if item.type=='separator' %}selected{% endif %}>Separator</option>
								<option value="header" {% if item.type=='header' %}selected{% endif %}>Header</option>
							</select>
							</div>
							<div class="col-md-3"><input type="text" class="form-control" name="{{ cur_field }}_{{ field_loop.index }}.columns_{{ col_loop.index }}_{{ loop.index }}_name" value="{{ item.name }}"></div>
							<div class="col-md-3"><input type="text" class="form-control" name="{{ cur_field }}_{{ field_loop.index }}.columns_{{ col_loop.index }}_{{ loop.index }}_value" value="{{ item.value }}"></div>
							<div class="col-md-3"><input type="text" class="form-control" name="{{ cur_field }}_{{ field_loop.index }}.columns_{{ col_loop.index }}_{{ loop.index }}_text" value="{{ item.text }}"></div>
						</div>
						{% endfor %}
						<div class="row button_row">
							<div class="col-md-9"></div>
							<div class="col-md-3">
								<button type="button" class="btn btn-danger btn-sm del_row">Remove row</button>
								<button type="button" class="btn btn-primary btn-sm add_row">Add row</button>
							</div>
						</div>
					</div>
					{% endfor %}
					<div class="row button_row">
						<div class="col-md-9"></div>
						<div class="col-md-3">
							<button type="button" class="btn btn-danger del_col">Remove column</button>
							<button type="button" class="btn btn-primary add_col">Add column</button>
						</div>
					</div>
					{% endfor %}
				</div>
				<div class="row button_row">
					<div class="col-md-9"></div>
					<div class="col-md-3">
						<button type="button" class="btn btn-danger del_field">Remove field</button>
						<button type="button" class="btn btn-primary add_field">Add field</button>
					</div>
				</div>
			</div>
		</div>
    </div>
</div>






</div>
</form>
</div>
</div>
<footer class="footer">
  <div class="container">
	<span class="text-muted">Tsakorpus 2.0 configuration page</span>
  </div>
</footer>
</body>
<script>
	$(function() {
		assign_corpus_setup_buttons();
	});
</script>
</html>